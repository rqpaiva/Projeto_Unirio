<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise de Cancelamento de Corridas</title>
    <!-- Biblioteca Leaflet para o mapa -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <!-- Adicionando o Papa Parse -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <style>
        #map { height: 400px; }
        body { font-family: Arial, sans-serif; }
        .content { width: 80%; margin: 0 auto; }
    </style>
</head>
<body>
    <div class="content">
        <h1>Análise de Cancelamento de Corridas</h1>
        <p>Carregue os dados de um aplicativo de mobilidade urbana para realizar uma análise estatística e visualização interativa das características das corridas.</p>

        <h2>Carregue seus dados:</h2>
        <input type="file" id="fileInput">
        <button onclick="processarDados()">Carregar Dados</button>

        <h3>Resumo da Análise</h3>
        <div id="resumo"></div>

        <h3>Visualizações</h3>
        <div id="map"></div>
    </div>

    <script>
        // Função para processar os dados CSV
        function processarDados() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                alert('Por favor, selecione um arquivo CSV.');
                return;
            }

            // Usando Papa Parse para analisar o arquivo CSV
            Papa.parse(file, {
                header: true,
                dynamicTyping: true,
                complete: function(results) {
                    const data = results.data;
                    console.log(data); // Exibe os dados carregados no console

                    // Exibe o resumo da análise no HTML
                    document.getElementById('resumo').innerHTML = `
                        <p>Arquivo carregado: ${file.name}</p>
                        <p>Total de registros: ${data.length}</p>
                        <!-- Aqui você pode incluir mais estatísticas a partir dos dados -->
                    `;

                    // Função que pode exibir as visualizações no mapa
                    visualizarNoMapa(data);
                },
                error: function(error) {
                    console.error('Erro ao processar o arquivo:', error);
                    alert('Erro ao processar o arquivo CSV.');
                }
            });
        }

        // Função para configurar e exibir o mapa
        function visualizarNoMapa(data) {
            const map = L.map('map').setView([-22.9068, -43.1729], 10); // Foco inicial no Rio de Janeiro
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            // Exemplo de visualização com coordenadas do arquivo de dados (ajuste conforme necessário)
            data.forEach(item => {
                if (item.latitude && item.longitude) {
                    L.marker([item.latitude, item.longitude]).addTo(map);
                }
            });
        }
    </script>
</body>
</html>